---
title: コメントの書式サポート
icon: format
order: 1
---

コメントには、拡張 Markdown 構文や HTML タグを含むさまざまなコンテンツを追加できます。

<!-- more -->

## 書式サポート

完全な CommonMark（標準 Markdown 構文）に加えて、以下の拡張をサポートしています:

- GFM スタイルのテーブル
- GFM スタイルの取り消し線
- 下付き文字と上付き文字
- 絵文字
- コードブロックのハイライト
- $\TeX$ 数式

::: info GFM

Github Flavored Markdown

:::

また、[保護機能](./safety.md#comment-security)を発動させることなく、任意の HTML コンテンツを自由に埋め込むことができます。

## 制限されたプレビューのサポート

クライアントのサイズを制御するため、公式クライアント `@waline/client` には小型の Markdown パーサーのみが含まれており、多くの文法がプレビューパネルで正しく表示されないことがあります（コメントエリアでは**正しくレンダリングされます**）。

これには以下の制限が含まれます:

- 標準絵文字構文（例: :tada: `:tada:`）が正しくレンダリングされない

- 上付き・下付き文字（例: `H~2~O`、`x^2^`）が正しくレンダリングされない

- $\TeX$ 構文、つまり数式（例: `$a = 1$`）はデフォルトではレンダリングされない。

  公式クライアントを使用する場合、`texRenderer` オプションを設定することでプレビュー時の $\TeX$ レンダリングをカスタマイズできます。詳細は [クックブック → カスタム $\TeX$ レンダラーの使用](../../cookbook/customize/tex-renderer.md) を参照してください。

- デフォルトのハイライターでは、コードブロックは特定の区切り文字でランダムな色でハイライトされます。

  公式クライアントを使用する場合、`highlighter` オプションを設定することでプレビュー時のコードハイライトをカスタマイズできます。詳細は [クックブック → カスタムコードハイライト](../../cookbook/customize/highlighter.md) を参照してください。

## 詳細

::: tip 仕組み

1. パッケージサイズを考慮して、クライアントはデフォルトでレンダリングに `marked` を使用し、ハイライトには 1KB 未満のハイライターを使用します。また $\TeX$ レンダラーは含まれていないため、上記の制限が生じます。

1. ユーザーがコメントを送信すると、クライアントはカスタム絵文字画像を埋め込み、元のコメントをサーバーに送信します。

1. サーバーは元のテキストを受け取り、`markdown-it` と関連プラグインを使って Markdown を正しくレンダリングし、`prismjs` を使って言語に応じたコードブロックのハイライトを行い、ユーザー設定に基づいて $\TeX$ レンダリングを実施した後、最終的に XSS 処理を行います。

1. 処理が完了すると、サーバーは正しくレンダリングされたコンテンツを保存し、必要に応じてクライアントに返すことでコメントエリアの正常な表示を保証します。

:::
