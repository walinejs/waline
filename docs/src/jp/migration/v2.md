---
title: @waline/client V2 への移行
icon: migration
---

## API の変更

Waline のデフォルトエクスポートを削除し、代わりに以下のエクスポートを提供します：

- `init`: 旧 `Waline` と同様の動作
- `version`: バージョン番号
- `commentCount`: コメント数の更新
- `pageviewCount`: 訪問数の更新
- `RecentComments`: 最近のコメント

Waline のデフォルトエクスポートを `init` という名前付きエクスポートに変更し、Waline を SSR フレンドリーにするため、V2 では CSS を別途エクスポートします。

ほとんどの場合、以下の変更を行うだけです：

```diff
- <script src='//cdn.jsdelivr.net/npm/@waline/client'></script>
+ <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
+ <link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet' />

  <script>
-  Waline({
+  Waline.init({
    el: '#waline',
    serverURL: 'YOUR SERVER URL'
  });
  </script>
```

## 追加されたオプション

- `comment` オプションが CSS セレクターとしての文字列設定をサポートしました。
- `pageview` オプションが CSS セレクターとしての文字列設定をサポートしました。

## 名称変更されたオプション

- `uploadImage` が `imageUploader` に名称変更

- `highlight` が `highlighter` に名称変更

- `previewMath` が `texRenderer` に名称変更

- `visitor` が `pageview` に名称変更

## 削除されたオプション

以下のオプションは V1 で長らく非推奨 API としてマークされており、V2 で削除されました。

- `langMode`: `locale` を使用
- `placeholder`: `locale.placeholder` を使用
- `emojiCDN`: `emoji` を使用
- `emojiMaps`: `emoji` を使用
- `requiredFields`: `requiredMeta` を使用
- `avatar`: サーバー変数 `AVATAR_PROXY` を使用
- `avatarCDN`: サーバー変数 `AVATAR_PROXY` を使用
- `avatarForce`: デフォルトでリフレッシュ
- `anonymous`: `login` を使用
- `mathTagSupport`: `texRenderer` を使用
- `copyRight`: `copyright` を使用

## その他の変更

### インスタンス

`Waline.init` は、必須プロパティ `el`、`serverURL` が無効な場合、理由を含むエラーインスタンスを返す代わりにエラーをスローするようになりました。

ユーザーが無効なオプションを設定した場合の互換性のために、`try { ... } catch (err) { ... }` ブロックを使用してエラーをキャッチできます。

### 更新動作の変更

- Waline は `Instance.update` を介して `el` オプション以外のすべてのオプションの更新をサポートするようになりました。
- `update()` 時に `path` パラメーターがリセットされます。つまり、`update()` 時に `path` オプションを渡さない限り、`window.location.pathname` になります。

### コメントとページビューのセレクター変更

Valine のセレクター互換性に関するコメントとビューは削除されました。

- コメントセレクターのデフォルトは `'.waline-comment-count'`
- ページビューセレクターのデフォルトは `'.waline-pageview-count'`

現在のページとは異なるセレクターの値を取得する必要がある場合は、`data-path` 属性の使用を強くお勧めします。

互換性のために、以前の `id` 属性サポートは引き続き保持していますが、この互換性は V3 で削除される予定です。

### CSS クラスの変更

すべての CSS クラスが `v` から `wl-` に変更されました。
